{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport { Controller } from \"stimulus\";\nimport { truncate } from \"./utilities.js\";\n\nvar _default = /*#__PURE__*/function (_Controller) {\n  _inherits(_default, _Controller);\n\n  var _super = _createSuper(_default);\n\n  function _default() {\n    _classCallCheck(this, _default);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(_default, [{\n    key: \"showDropdown\",\n    value: function showDropdown() {\n      if (this.open === 'true') return;\n      this.loadItems(event);\n    }\n  }, {\n    key: \"hideDropdown\",\n    value: function hideDropdown(event) {\n      if (this.open === 'true' && this.element.contains(event.target) === false) {\n        this.containerTarget.remove();\n        this.data.set('open', false);\n      }\n    }\n  }, {\n    key: \"loadItems\",\n    value: function loadItems() {\n      var _this = this;\n\n      this.buttonTarget.insertAdjacentHTML('beforeend', \"<div class=\\\"absolute top-0 right-0 mt-6 w-auto max-w-sm whitespace-no-wrap bg-white shadow-xl rounded slideUp z-20\\\" data-target=\\\"sjabloon--announcements.container\\\"><span class=\\\"block p-2 text-gray-600\\\">Loading\\u2026</span></div>\");\n      var html = '';\n      fetch(this.data.get('data-url')).then(function (data) {\n        return data.json();\n      }).then(function (announcements) {\n        var html = \"\";\n        announcements.forEach(function (json) {\n          html += _this.itemTemplate(json);\n        });\n        _this.containerTarget.innerHTML = html;\n\n        _this.containerTarget.insertAdjacentHTML('beforeend', _this.templateFooter());\n\n        _this.containerTarget.insertAdjacentHTML('afterbegin', _this.templateHeader());\n\n        _this.data.set('open', true);\n      });\n    }\n  }, {\n    key: \"itemTemplate\",\n    value: function itemTemplate(item) {\n      return \"\\n      <a href=\".concat(this.data.get('url'), \"#announcement_\").concat(item.id, \" class='block w-full py-2 border-t border-gray-200 cursor-pointer first:border-t-0 hover:bg-gray-100'>\\n        <header class='flex items-center px-2 leading-tight'>\\n          <span class='announcement__type announcement__type--\").concat(item.announcement_type, \" mb-0 static'>\").concat(item.announcement_type, \"</span>\\n\\n          <h4 class='ml-2 text-sm font-semibold text-gray-700 truncate'>\\n            \").concat(item.title, \"\\n          </h4>\\n        </header>\\n\\n        <p class='py-1 px-3 text-left text-sm text-gray-600 whitespace-normal'>\\n          \").concat(truncate(item.body, 70, '…'), \"\\n        </p>\\n      </a>\\n    \");\n    }\n  }, {\n    key: \"templateHeader\",\n    value: function templateHeader() {\n      return \"\\n      <p class='block w-full py-2 text-sm font-semibold text-gray-700 rounded-t'>Announcements</p>\\n    \";\n    }\n  }, {\n    key: \"templateFooter\",\n    value: function templateFooter() {\n      return \"\\n      <a href='\".concat(this.data.get('url'), \"' class='block w-full py-1 text-sm text-gray-500 bg-gray-100 border-t border-gray-200 rounded-b hover:text-gray-600'>View all announcements</a>\\n    \");\n    }\n  }, {\n    key: \"open\",\n    get: function get() {\n      return this.data.get('open');\n    }\n  }]);\n\n  return _default;\n}(Controller);\n\n_default.targets = [\"button\", \"container\"];\nexport { _default as default };","map":{"version":3,"sources":["/home/good-dev/Documents/Work/heytasker4/frontend/controllers/sjabloon/announcements_controller.js"],"names":["Controller","truncate","open","loadItems","event","element","contains","target","containerTarget","remove","data","set","buttonTarget","insertAdjacentHTML","html","fetch","get","then","json","announcements","forEach","itemTemplate","innerHTML","templateFooter","templateHeader","item","id","announcement_type","title","body","targets"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,SAASA,UAAT,QAA2B,UAA3B;AACA,SAASC,QAAT,QAAyB,gBAAzB;;;;;;;;;;;;;;;mCAKiB;AACb,UAAI,KAAKC,IAAL,KAAc,MAAlB,EAA0B;AAE1B,WAAKC,SAAL,CAAeC,KAAf;AACD;;;iCAEYA,K,EAAO;AAClB,UAAK,KAAKF,IAAL,KAAc,MAAf,IAA2B,KAAKG,OAAL,CAAaC,QAAb,CAAsBF,KAAK,CAACG,MAA5B,MAAwC,KAAvE,EAA+E;AAC7E,aAAKC,eAAL,CAAqBC,MAArB;AAEA,aAAKC,IAAL,CAAUC,GAAV,CAAc,MAAd,EAAsB,KAAtB;AACD;AACF;;;gCAEW;AAAA;;AACV,WAAKC,YAAL,CAAkBC,kBAAlB,CAAqC,WAArC;AAGA,UAAIC,IAAI,GAAG,EAAX;AACAC,MAAAA,KAAK,CAAC,KAAKL,IAAL,CAAUM,GAAV,CAAc,UAAd,CAAD,CAAL,CACGC,IADH,CACS,UAAAP,IAAI,EAAI;AACb,eAAOA,IAAI,CAACQ,IAAL,EAAP;AACD,OAHH,EAGKD,IAHL,CAGW,UAAAE,aAAa,EAAI;AACxB,YAAIL,IAAI,GAAG,EAAX;AAEAK,QAAAA,aAAa,CAACC,OAAd,CAAsB,UAACF,IAAD,EAAU;AAC9BJ,UAAAA,IAAI,IAAI,KAAI,CAACO,YAAL,CAAkBH,IAAlB,CAAR;AACD,SAFD;AAIA,QAAA,KAAI,CAACV,eAAL,CAAqBc,SAArB,GAAiCR,IAAjC;;AACA,QAAA,KAAI,CAACN,eAAL,CAAqBK,kBAArB,CAAwC,WAAxC,EAAqD,KAAI,CAACU,cAAL,EAArD;;AACA,QAAA,KAAI,CAACf,eAAL,CAAqBK,kBAArB,CAAwC,YAAxC,EAAsD,KAAI,CAACW,cAAL,EAAtD;;AAEA,QAAA,KAAI,CAACd,IAAL,CAAUC,GAAV,CAAc,MAAd,EAAsB,IAAtB;AACD,OAfH;AAgBD;;;iCAEYc,I,EAAM;AACjB,uCACY,KAAKf,IAAL,CAAUM,GAAV,CAAc,KAAd,CADZ,2BACiDS,IAAI,CAACC,EADtD,kPAG4DD,IAAI,CAACE,iBAHjE,2BAGmGF,IAAI,CAACE,iBAHxG,8GAMUF,IAAI,CAACG,KANf,gJAWQ3B,QAAQ,CAACwB,IAAI,CAACI,IAAN,EAAY,EAAZ,EAAgB,GAAhB,CAXhB;AAeD;;;qCAEgB;AACf;AAGD;;;qCAEgB;AACf,wCACa,KAAKnB,IAAL,CAAUM,GAAV,CAAc,KAAd,CADb;AAGD;;;wBAEU;AACT,aAAO,KAAKN,IAAL,CAAUM,GAAV,CAAc,MAAd,CAAP;AACD;;;;EAxE0BhB,U;;SACpB8B,O,GAAU,CAAE,QAAF,EAAY,WAAZ,C","sourcesContent":["import { Controller } from \"stimulus\"\nimport { truncate } from \"./utilities.js\"\n\nexport default class extends Controller {\n  static targets = [ \"button\", \"container\" ]\n\n  showDropdown() {\n    if (this.open === 'true') return\n\n    this.loadItems(event)\n  }\n\n  hideDropdown(event) {\n    if ((this.open === 'true') && (this.element.contains(event.target) === false)) {\n      this.containerTarget.remove()\n\n      this.data.set('open', false)\n    }\n  }\n\n  loadItems() {\n    this.buttonTarget.insertAdjacentHTML('beforeend',\n      `<div class=\"absolute top-0 right-0 mt-6 w-auto max-w-sm whitespace-no-wrap bg-white shadow-xl rounded slideUp z-20\" data-target=\"sjabloon--announcements.container\"><span class=\"block p-2 text-gray-600\">Loading…</span></div>`);\n\n    var html = ''\n    fetch(this.data.get('data-url'))\n      .then( data => {\n        return data.json()\n      }).then( announcements => {\n        var html = \"\"\n\n        announcements.forEach((json) => {\n          html += this.itemTemplate(json)\n        })\n\n        this.containerTarget.innerHTML = html\n        this.containerTarget.insertAdjacentHTML('beforeend', this.templateFooter())\n        this.containerTarget.insertAdjacentHTML('afterbegin', this.templateHeader())\n\n        this.data.set('open', true)\n      })\n  }\n\n  itemTemplate(item) {\n    return `\n      <a href=${this.data.get('url')}#announcement_${item.id} class='block w-full py-2 border-t border-gray-200 cursor-pointer first:border-t-0 hover:bg-gray-100'>\n        <header class='flex items-center px-2 leading-tight'>\n          <span class='announcement__type announcement__type--${item.announcement_type} mb-0 static'>${item.announcement_type}</span>\n\n          <h4 class='ml-2 text-sm font-semibold text-gray-700 truncate'>\n            ${item.title}\n          </h4>\n        </header>\n\n        <p class='py-1 px-3 text-left text-sm text-gray-600 whitespace-normal'>\n          ${truncate(item.body, 70, '…')}\n        </p>\n      </a>\n    `\n  }\n\n  templateHeader() {\n    return `\n      <p class='block w-full py-2 text-sm font-semibold text-gray-700 rounded-t'>Announcements</p>\n    `\n  }\n\n  templateFooter() {\n    return `\n      <a href='${this.data.get('url')}' class='block w-full py-1 text-sm text-gray-500 bg-gray-100 border-t border-gray-200 rounded-b hover:text-gray-600'>View all announcements</a>\n    `\n  }\n\n  get open() {\n    return this.data.get('open')\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}